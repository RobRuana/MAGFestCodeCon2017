<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

    <title>Thoughts on Ubersystem</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/white.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/github.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ?
          'css/print/pdf.css' :
          'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->

    <style>
      /* Border Box */
      html { box-sizing: border-box; }
      *, *:before, *:after { box-sizing: inherit; }

      /* Jumpy Fonts on Safari */
      * { -webkit-transform-style: preserve-3d; }

      /* Layout Classes */
      .reveal .block { display: block; }
      .reveal .clearfix { clear: both; }
      .reveal .inline { display: inline; }
      .reveal .inline-block { display: inline-block; }
      .reveal .pull-left { float: left; }
      .reveal .pull-right { float: right; }
      .reveal .paragraph {
        line-height: 1.3;
        margin-bottom: 20px;
        margin-top: 20px;
      }

      /* Text Classes */
      .reveal .text-xl { font-size: 1.5em; }
      .reveal .text-lg { font-size: 1.25em; }
      .reveal .text-md { font-size: 1em; }
      .reveal .text-sm { font-size: 0.75em; }
      .reveal .text-xs { font-size: 0.5em; }
      .reveal .text-pre { white-space: pre; }
      .reveal .text-mono { font-family: monospace; }
      .reveal .text-red { color: #ff0000; }
      .reveal .text-light { opacity: 0.375; }
      .reveal .text-subtle { opacity: 0.5; }
      .reveal .text-normal { font-style: normal; }
      .reveal .text-italic { font-style: italic; }
      .reveal .text-bold { font-weight: bold; }
      .reveal .text-center { text-align: center; }
      .reveal .text-left { text-align: left; }
      .reveal .text-right { text-align: right; }

      /* Element Defaults */
      .reveal blockquote {
        width: 90%;
        padding: 0.5em;
        background-color: #f8f8f8;
      }

      .reveal code {
        padding-left: 0.25em;
        padding-right: 0.25em;
      }

      .reveal h1, .reveal h2, .reveal h3, .reveal h4, .reveal h5, .reveal h6 {
        text-transform: none;
      }

      .reveal ol, .reveal ul,
      .reveal ol ol, .reveal ol ul,
      .reveal ul ol, .reveal ul ul { margin: 0; }
      .reveal ol li, .reveal ul li { margin-left: 1.25em; }

      .reveal .list-none { list-style: none; }
      .reveal .list-none li { margin-left: 0; }

      .reveal pre { box-shadow: none; margin: 0 auto; }
      .reveal pre code { max-height: 600px; }
      .reveal section { text-align: left; }

      .reveal section img {
        margin: 0;
        background: none transparent;
        border: 0 none transparent;
        box-shadow: none;
      }

      /* Layered Image */
      .reveal .img {
        position: relative;
        width: 1600px;
        height: 774px;
      }

      .reveal .img .img-layer {
        position: absolute;
        left: 0;
        top: 0;
        width: 1520px;
        height: 720px;
      }

      /* Monospace Font */
      .reveal code, .reveal .file, .reveal .plugin, .reveal .db, .reveal .service,
      .reveal code *, .reveal .file *, .reveal .plugin *, .reveal .db *, .reveal .service * {
        font-family: monospace;
      }

      /* DB Table */
      .reveal .db .db-table table th,
      .reveal .db .db-table table td,
      .reveal .db .db-table table tbody tr:last-child th,
      .reveal .db .db-table table tbody tr:last-child td {
        border: 1px solid #606060;
      }

      .reveal .db .db-table {
        width: 100%;
        padding: 0 1.25em 1.25em;"
      }

      .reveal .db .db-table table {
        width: 100%;
      }

      /* Gray Block Backgrounds */
      .reveal code, .reveal .panel, .reveal .plugin, .reveal .service {
        background-color: #f0f0f0;
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 3px;
        color: #333;
      }

      .reveal .panel pre {
        font-size: 1em;
        margin: 0 0 0 1.25em;
        width: 100%;
      }

      .reveal .panel pre code {
        background-color: transparent;
        border: 0 none transparent;
        border-radius: 0;
      }

      .reveal .panel .panel,
      .reveal .panel .plugin { background-color: #e0e0e0; }
      .reveal .panel .panel .panel,
      .reveal .panel .panel .plugin { background-color: #d0d0d0; }
      .reveal .panel .panel .panel .panel,
      .reveal .panel .panel .panel .plugin,
      .reveal .panel .panel .plugin .panel { background-color: rgba(0, 0, 0, 0.1); }

      /* Plugins */
      .reveal .plugin { display: inline-block; }
      .reveal .plugin, .reveal .service {
        padding: 0 0.25em;
      }

      .reveal li .plugin {
        margin-bottom: 0.25em;
      }

      .reveal .folder .plugin {
        padding: 0.25em 0.5em;
        display: block;
      }

      /* Panels */
      .reveal .panel {
        padding: 0.5em;
        margin-bottom: 0.25em;
      }

      .reveal .panel:last-child {
        margin-bottom: 0;
      }

      .reveal .plugin .panel {
        margin-bottom: 0;
        padding: 0.2em 0.5em;
      }

      .reveal .panel h1, .reveal .panel h2, .reveal .panel h3,
      .reveal .panel h4, .reveal .panel h5, .reveal .panel h6 {
        margin-bottom: 0.25em;
      }

      .reveal .panel h1 { font-size: 1.25em; }

      .panel ul { list-style: none; }
      .panel .panel { font-size: 0.75em; margin-left: 1.25em; }
      .panel li .panel { margin-left: 0; }
      .panel .panel li { margin-left: 0; }

      /* Columns */
      .reveal .col-1, .reveal .col-2, .reveal .col-3, .reveal .col-4,
      .reveal .col-5, .reveal .col-6, .reveal .col-7, .reveal .col-8,
      .reveal .col-9, .reveal .col-10, .reveal .col-11, .reveal .col-12 {
        float: left;
        padding-left: 15px;
        padding-right: 15px;
        width: 100%;
      }

      .reveal .col-1 { width: 8.3%; }
      .reveal .col-2 { width: 16.6%; }
      .reveal .col-3 { width: 25%; }
      .reveal .col-4 { width: 33.3%; }
      .reveal .col-5 { width: 41.6%; }
      .reveal .col-6 { width: 50%; }
      .reveal .col-7 { width: 58.3%; }
      .reveal .col-8 { width: 66.6%; }
      .reveal .col-9 { width: 75%; }
      .reveal .col-10 { width: 83.3%; }
      .reveal .col-11 { width: 91.6%; }
      .reveal .col-12 { width: 100%; }

      /* Icons */
      .reveal .icon,
      .reveal .title::before {
        content: " ";
        background-repeat: no-repeat;
        background-size: 100% 100%;
        display: inline-block;
        margin-right: 0.25em;
        height: 1.5em;
        width: 1.5em;
        vertical-align: middle;
      }

      .service > .title::before, .glyphicon-cogwheels {
        background-image: url(images/glyphicons/glyphicons-cogwheels.png);
      }

      .db > .title::before, .glyphicon-database {
        background-image: url(images/glyphicons/glyphicons-database.png);
      }

      .folder > .title::before, .glyphicon-folder {
        background-image: url(images/glyphicons/glyphicons-folder-open.png);
      }

      .plugin > .title::before, .glyphicon-puzzle {
        background-image: url(images/glyphicons/glyphicons-puzzle.png);
      }

      .file > .title::before, .glyphicon-file {
        background-image: url(images/glyphicons/glyphicons-file.png);
      }

      .package > .title::before, .glyphicon-package {
        background-image: url(images/glyphicons/glyphicons-cube-black.png);
      }

    </style>
  </head>

  <body>
    <div class="reveal">
      <div class="slides">

<section class="text-center">
  <h1>Thoughts on Ubersystem</h1>
  <p class="text-sm text-subtle text-italic">Press O to toggle overview</p>
  <p class="text-sm text-subtle text-italic">Press S to toggle speaker notes</p>
  <p class="text-sm text-subtle text-italic">Arrow keys ←, ↑, →, ↓, to navigate</p>
  <p class="text-sm text-subtle text-italic">
    Slides available:
    <a href="http://robruana.com/ThoughtsOnUbersystem/">
      robruana.com/ThoughtsOnUbersystem
    </a>
  </p>
  <p class="text-sm text-subtle text-italic">
    Source available:
    <a href="https://github.com/RobRuana/ThoughtsOnUbersystem/">
      github.com/RobRuana/ThoughtsOnUbersystem
    </a>
  </p>

  <aside class="notes">
    Hey everybody, my name is Rob Ruana, and I'm the Director of Software
    Engineering at MAGFest.
    <br><br>
    Today – if you'll let me – I'd like to talk about the future of software
    development at MAGFest.
    <br><br>
    In particular, I have some thoughts on Ubersystem, the software we
    developed in-house to handle event registration and volunteer management.
    <br><br>
    These slides and their source code is available online at the provided
    links.
  </aside>
</section>

<section>
  <h1>Overview</h1>
  <ol>
    <li class="fragment">
      Review pain points in current system
      <aside class="notes">
        The first thing we're going to cover are a few pain points in our
        current system. These are – I guess – design decisions that have caused
        serious development, or maintenance headaches. These might be things
        that've prevented us from scaling up to handle heavy load, or have just
        been generally annoying.
      </aside>
    </li>
    <li class="fragment">
      Proposal for refactoring current system
      <aside class="notes">
        The next thing we'll cover are some ideas for refactoring the current
        system to alleviate some of our pain points
      </aside>
    </li>
    <li class="fragment">
      Proposal for a persistent, multi-year system
      <aside class="notes">
        And finally, we'll cover a proposal for a multi-year, multi-event,
        persistent system to replace our current paradigm – which is one server
        per-event.
      </aside>
    </li>
  </ol>
</section>

<section>
  <section>
    <h1>Pain Points</h1>
    <div class="text-center">
      <p class="fragment text-md">
        The tradition of Festivus begins with the airing of grievances.
      </p>
      <p class="fragment text-lg">
        I got a lot of problems with you people...
      </p>
      <p class="fragment text-xl">
        And now, you're gonna hear about it!
      </p>
    </div>
    <aside class="notes">
      After putting this presentation together, I realized I spent the first
      <em>half</em> of the presentation <em>absolutely railing</em>
      on the current code base. So I think it's really important to take a
      moment to say I am not criticizing – or judging – the developers that
      built the current system. It grew organically over several iterations,
      created by volunteers working in their spare time. So I totally
      understand how the system grew to be the way it is, and why things are
      the way they are.
      <br><br>
      And I should mention, every developer writes bad code, myself included!
      Any developer that tells you they don't write bad code has fooled
      themselves!
      <br><br>
      Right? And there's a lot <em>really good</em> code in there, too!
      There's a lot of great stuff in there!
      <br><br>
      So, caveats aside, let's jump in!
    </aside>
  </section>

  <section>
    <h1>Pain Points</h1>
    <h2>The issue</h2>
    <p>Modules with import side effects:</p>
    <pre class="paragraph"><code data-trim data-noescape>
import sideboard
    </code></pre>

    <aside class="notes">
      A lot of our modules have side effects when they're imported. For
      example, calling <code>import sideboard</code> not only loads every
      available sideboard module and plugin, <em>it also</em> opens a
      connection to your database and initializes your schema.
      <br><br>
      All before that statement even returns!
    </aside>

    <h2 class="fragment">
      Why is this an issue?
      <aside class="notes">
        I know what some of you are thinking... why is this an issue?
      </aside>
    </h2>
    <ol>
      <li class="fragment">
        Circular import dependencies
        <aside class="notes">
          Well, for starters, it makes it much easier to accidentally introduce
          circular import dependencies. You have much less control of how and
          when modules are imported. To avoid circular dependencies, you end up
          having to declare your functions, and put your import statements in
          weird and unexpected places.
        </aside>
      </li>
      <li class="fragment">
        Makes script writing difficult
        <aside class="notes">
          And it's not just circular dependencies. It makes script writing
          much trickier. We have a lot of one-off command line scripts, and
          for most of those we want the full environment loaded with a
          configured database. But sometimes we definitely <em>don't</em>
          want that, like for our database migration scripts.
          <br><br>
          I had to completely redo the way the system loads for our database
          migration scripts, because calling <code>import sideboard</code>
          would try to completely configure the database before the migration
          code even had a chance to run.
          <br><br>
          It was nightmarish!
        </aside>
      </li>
      <li class="fragment">
        Using a package as a library is impossible
        <aside class="notes">
          And you can forget about using the package as a third party library.
          Let's say you just want to use one of sideboard's nice string
          manipulation functions in one of your projects. You'd expect you
          could write
          <code>from sideboard import camelcase_to_underscore</code>, but nope!
          <br><br>
          If you wanna convert a camel case string to underscores, you better
          have a database configured and ready to accept connections!
        </aside>
      </li>
    </ol>
  </section>

  <section>
    <h1>Pain Points</h1>
    <h2>The issue</h2>
    <p><code>common.py</code> and wildcard import statements:</p>
    <pre class="paragraph"><code data-trim data-noescape>
from uber.common import *
    </code></pre>

    <aside class="notes">
      So this is a thing we do all over the place. And it's not just that we
      use wildcard imports.
      <br><br>
      We've managed to magnify the issue by creating a single file called
      <code>common.py</code> into which <em>everything</em> is imported. And
      then in all our other files we do <code>from uber.common import *</code>.
    </aside>

    <h2 class="fragment">
      Why is this an issue?
      <aside class="notes">
        Okay, so if everything's working, why is this even an issue?
      </aside>
    </h2>
    <ol>
      <li class="fragment">
        Name collisions
        <aside class="notes">
          First, it introduces the possibility of name collisions. It's the
          equivalent of taking our heirarchy of namespaces and smooshing them
          down into a single namespace.
          <br><br>
          We might as well be writing PHP at that point!
          <br><br>
          It's entirely possible that we've already got name collisions that
          we don't even know about. Just waiting. Like a bear trap. Waiting to
          <em>clamp</em> down on our poor unsuspecting production servers!
        </aside>
      </li>
      <li class="fragment">
        Static analysis via <code>flake8</code> is impossible
        <aside class="notes">
          Which leads me to my next point. Static analysis against our current
          codebase with tools like <code>flake8</code> is nearly impossible.
          We've already seen several bugs that would have been prevented by
          using <code>flake8</code>.
          <br><br>
          I can't help but wonder how many more bugs are riddled throughout
          our codebase that we could easily prevent.
        </aside>
      </li>
      <li class="fragment">
        It's straight up admonished in
        <a href="https://www.python.org/dev/peps/pep-0008/">pep8</a>
        <aside class="notes">
          I don't normally like to make appeals to authority, but I'll make an
          exception here. It's straight up admonished in pep8 – for many of the
          same reasons.
        </aside>
      </li>
    </ol>
  </section>

  <section>
    <h1>Pain Points</h1>
    <h2>The issue</h2>
    <p>Unneccesary multithreading:</p>

    <pre class="paragraph"><code data-trim data-noescape>
DaemonTask(SendAllAutomatedEmailsJob.send_all_emails, interval=300, name="send emails")
    </code></pre>

    <aside class="notes">
      This kind of a double edged sword. Sideboard makes it really easy to spin
      up a background task that runs in a separate thread. Which is great!
      Except we've abused this feature by putting a bunch of tasks that should
      be separate processes into separate threads in the same process.
    </aside>

    <h2 class="fragment">
      Why is this an issue?
      <aside class="notes">
        Okay, so why is this an issue? What's the difference between a
        background thread and a background process?
      </aside>
    </h2>
    <ol>
      <li class="fragment">
        Makes load balancing impossible
        <aside class="notes">
          The number one issue with running tasks in a background thread is
          that it prevents us from load balancing our web servers. We'd like to
          run multiple web servers and spread the load accross them evenly.
          But if each of our web servers <em>also</em> spins up an email
          server, then each web server will be send out the same emails twice.
          <br><br>
          There's other examples of where this is a problem, but the point is
          clear. Things like our email daemon should be an entirely separate
          process.
        </aside>
      </li>
      <li class="fragment">
        <code>BADGE_LOCK</code>!
        <aside class="notes">
          Phoof... I don't even want to get into <code>BADGE_LOCK</code>, but
          if you know what I'm talking about, you'll know what a nightmare it
          is.
          <br><br>
          The good news is that I'm about <i>this close</i> to ripping it out
          completely.
        </aside>
      </li>
    </ol>
  </section>

  <section>
    <h1>Pain Points</h1>
    <h2>The issue</h2>
    <p>Sessions stored on filesystem</p>

    <aside class="notes">
      Currently, we use the filesystem to store cherrypy's session data.
    </aside>

    <h2 class="fragment">
      Why is this an issue?
      <aside class="notes">
        So, why is this an issue?
      </aside>
    </h2>
    <ol>
      <li class="fragment">
        Makes load balancing more difficult
        <aside class="notes">
          Well, it makes load balancing more difficult. Our only option would
          be to mount a shared filesystem to store the session files.
        </aside>
      </li>
      <li class="fragment">
        Super easy to change
        <aside class="notes">
          Everyone likes to bring this up as a big issue, but the reality is
          that this would be super easy to change. It's literally just a
          cherrypy config setting. But until we fix the issue with background
          threads, changing this won't really buy us anything.
        </aside>
      </li>
    </ol>
  </section>

  <section>
    <h1>Pain Points</h1>
    <h2>The issue</h2>
    <p>Validations are not intrinsic to our data model</p>

    <aside class="notes">
      The next issue I want to talk about is that our validations are not
      intrinsic to our data model. What this means is that the code we use to
      verify the correctness of our data lives in a separate module from the
      code that defines our data model.
      <br><br>
      In order to validate a model object, we have to manually call a
      validation check.
    </aside>

    <h2 class="fragment">
      Why is this an issue?
      <aside class="notes">
        Again, everything seems to be working fine, so why is this an issue?
      </aside>
    </h2>
    <ol>
      <li class="fragment">
        Easy to forget to run validations
        <aside class="notes">
          First, it's easy to forget to run the validation checks. I'm like 90%
          sure that there are places in our codebase where we are just not
          validating incoming data. Aside from unit tests, we have no easy way
          of detecting that. And our test coverage is not great.
        </aside>
      </li>
      <li class="fragment">
        We're unable to expose our JSON API
        <aside class="notes">
          But the real issue with the way we run our validations is that we
          can't expose our JSON API. Our JSON API completely bypasses our
          validations.
          <br><br>
          Until we integrate our validations into our data model, our hands
          are essentially tied.
        </aside>
      </li>
    </ol>
  </section>

  <section>
    <h1>Pain Points</h1>
    <h2>The issue</h2>
    <p>Plugin architecture</p>

    <aside class="notes">
      This is a big issue. There's nothing inherently wrong with our plugin
      architecture. In fact, from a technical perspective, it's actually
      really cool.
    </aside>

    <h2 class="fragment">
      Why is this an issue?

      <aside class="notes">
        So why even bring it up? Well, it's a complex design whos
        consequences are varied and manifold. It doesn't cause one big problem.
        Instead it's a bunch of tiny annoyances that exhaust development time
        and mental energy.
        <br><br>
        It's death by a thousand cuts.
      </aside>
    </h2>
    <ol>
      <li class="fragment">
        Complexity multiplier
        <aside class="notes">
          The easiest way to describe it, is as a complexity multiplier. It
          makes every task more complex and error prone.
        </aside>
        <ul>
          <li class="fragment">
            Multiple repositories
            <aside class="notes">
              To start with, we have multiple git repositories. So for many of
              our bug fixes, we don't have just <em>one</em> branch with
              <em>one</em> pull request. We have to create a separate pull
              request for each repository involved in the bug fix. Bug fixes
              and features often require changes to two, three, four, even up
              to <em>fifteen</em> repositories in some cases.
              <br><br>
              It's definitely do-able, as evidenced by the fact that we've
              been, you know... doing it. But it's been the source of bugs,
              and it takes mental energy.
            </aside>
          </li>
          <li class="fragment">
            Difficult to maintain a <code>stable</code> branch
            <aside class="notes">
              It makes it difficult to maintain a <code>stable</code> branch.
              It would be nice if we could run our production servers off a
              stable branch in git, but synchronizing that across so many
              repositories and so many deployments would be a nightmare.
              <br><br>
              <em>This</em> commit in <em>this</em> repository, depends on this
              <em>other</em> commit in this <em>other</em> repository.
              Someone's gonna mess that up at some point, and we'd inevitably
              deploy a broken configuration to production.
              <br><br>
              Talk about exhausting mental energy.
            </aside>
          </li>
          <li class="fragment">
            Basic project management/issue tracking tasks become arduous, like using labels
            <aside class="notes">
              Basic project management tasks become arduous. Things like:
              sharing labels or epics between repositories. Collecting and
              prioritizing issues across repositories. Basic task tracking.
              <br><br>
              This is mainly a shortcoming of the issue tracking built into
              GitHub, but it's still a limitation we gotta live with.
            </aside>
          </li>
          <li class="fragment">
            Configuration management nightmare
            <aside class="notes">
              Like every other part of the system, it increases the complexity
              of our configuration management. Our production config has to
              manage 15 times the number of repositories and config files.
              <br><br>
              Which – sure – is not <em>that</em> complicated. It's just a lot
              of unneeded boilerplate that we could cut out.
            </aside>
          </li>
          <li class="fragment">
            Database migrations overly complex
            <aside class="notes">
              I'm going to call this feature out specifically, but it has the
              same impact on a lot of other features we create. Our database
              migrations are insanely complex. Each plugin has it's own
              migration branch, that creates this complex tree of
              interdependent scripts.
              <br><br>
              I mean – don't get me wrong – it works beautifully. Now that it's
              built, it's totally great, and totally easy to use. But getting
              database migrations set up correctly the first time around took
              about five times longer than it would have otherwise, because of
              our complex plugin architecture.
            </aside>
          </li>
        </ul>
      </li>
      <li class="fragment">
        No clear value added
        <aside class="notes">
          And here's the hook. For all the added complexity, there's no clear
          value added. What do we actually gain from our plugin architecture?
          I've yet to see any real benefit.
        </aside>
      </li>
    </ol>
  </section>

  <section>
    <h1>Pain Points</h1>
    <h2>The issue</h2>
    <p>Event configuration stored in config files</p>

    <aside class="notes">
      This is probably the least controversial issue that I'm going to bring
      up. We store all of our event configuration in flat config files instead
      of in the database.
    </aside>

    <h2 class="fragment">
      Why is this an issue?

      <aside class="notes">
        So, why is this an issue?
      </aside>
    </h2>
    <ol>
      <li class="fragment">
        Two kinds of config:
        <aside class="notes">
          Well, we really have two kinds of config...
        </aside>
        <ul>
          <li class="fragment">
            Service config (DB password, IP address/port, secret keys, etc...)
            <aside class="notes">
              We have our service configuration. Things like database
              passwords, ip addresses, secret keys. These are all the things
              you'd expect to find in any given service's config files.
            </aside>
          </li>
          <li class="fragment">
            Event config (Registration dates, badge prices, departments, etc...)
            <aside class="notes">
              Then we have our event configuration. Things like registration
              deadlines, badge prices, department listings. These are things
              you'd generally expect to find in a database table.
              <br><br>
              So again, why is this an issue?
            </aside>
          </li>
        </ul>
      </li>
      <li class="fragment">
        Changing event config requires a developer
        <aside class="notes">
          To start with, changing the event config requires a software
          developer to:
          <ul>
            <li>Create a branch in git</li>
            <li>Update the values in a config file</li>
            <li>Issue a pull request with the changes</li>
            <li>
              And finally, get approval from a <em>second</em> software
              developer
            </li>
          </ul>
          That is <em>not</em> a cheap proposition. It takes a lot of time,
          and developer time is not cheap. And it happens all the time.
          <br><br>
          <em>All. The. Time.</em>
          <br><br>
          Ideally, an event admin should be able to change a value and click
          a button on a web page. Like, why are we jumping through all these
          hoops? Doesn't make sense.
        </aside>
      </li>
      <li class="fragment">
        Changing event config requires a redeployment
        <aside class="notes">
          Not only that. In order to actually make changes to the event
          configuration, we have to redeploy our production servers.
          <br><br>
          Did you get that? If you want to change the deaadline for ordering
          T-Shirts, you have to take your production servers offline.
          <br><br>
          Madness!
        </aside>
      </li>
      <li class="fragment">
        Difficult to integrate our software into an existing ecosystem
        <aside class="notes">
          Because of our config files, our software is incredibly difficult to
          package. It's incredibly difficult to configure. Containerization is
          possible, but in practice it's unwieldy and brittle, because we have
          such large and varied config files.
        </aside>
      </li>
      <li class="fragment">
        <code>c</code> variable is not great
        <aside class="notes">
          The <code>c</code> variable, while very convenient, is actually not
          that great.
          <ul>
            <li>It exposes way too much data to our templates</li>
            <li>
              It hides complex, expensive functions under the guise of simple
              config variables
            </li>
            <li>
              It breaks standard config conventions – like the weird
              <code>[secret]</code> section – which prevents us from using
              our config to configure third party libraries like SQLAlchemy
            </li>
          </ul>
        </aside>
      </li>
    </ol>
  </section>

  <section>
    <h1>Pain Points</h1>
    <h2>The issue</h2>
    <p>Naming bifurcation (Ubersystem vs RAMS)</p>

    <aside class="notes">
      The astute listener will have noticed that our software is named
      Ubersystem.
    </aside>

    <h2 class="fragment">
      Why is this an issue?
      <aside class="notes">
        This is problematic for a number of reasons; the most obvious of which
        is that it shares its name with a certain ride-sharing company.
        <br><br>
        Everyone agrees that we need to change the name, and there have even
        been concerted efforts to do so. But those efforts were never finished,
        and what we're left with is this bizarre chimera. Are we developing
        Ubersystem? Are we developing RAMS? Are developing both?
        <br><br>
        Would a git repository by any other name smell as sweet?
        <br><br>
        And for anyone that thinks this isn't a big deal, I can speak from
        personal experience that this has very real, very concrete effects on
        onboarding new developers. It's a confusing to a new developer. I mean
        it's confusing to even talk about – never mind development.
      </aside>
    </h2>
    <blockquote class="fragment text-normal" cite="https://github.com/magfest/ubersystem">
<h3 class="inline-block">IMPORTANT NOTE</h3>
<a class="text-xs pull-right">https://github.com/magfest/ubersystem</a>
<div>
  This is a fork of the RAMS Project used by MAGFest. It may contain
  MAGFest-specific modifications and some less well-tested code. We recommend,
  unless you are actively developing for MAGFest, that you visit the parent
  project at https://github.com/ramsproject/rams
</div>
      <aside class="notes">
        This message is on the front page of our Ubersystem repository. I
        think it speaks for itself, but let me tell you what happened when I
        was first hired.
        <br><br>
        I like to think of myself as a pretty good developer, and I wanted to
        get a headstart when I was hired, so before my official start date I
        figured I would dig through the source code... figure out what I was
        dealing with. Get a handle on the situation.
        <br><br>
        That message was the first thing I was greeted with, and I took it at
        face value. So I headed over to the RAMS project. Which had the same
        message on its front page. And I was like, "okay, I guess I can't
        trust the documentation here..."
        <br><br>
        And it was several days of digging through repositories, and following
        links, just trying to get a handle on the project. It is... byzantine.
        And I pretty sure I'm using that word correctly.
        <br><br>
        So you can't say the naming bifurcation isn't important. It's a huge
        hurdle to onboarding new developers.
      </aside>
    </blockquote>
  </section>
</section>

<section>
  <section>
    <h1>Refactor</h1>
    <p>Currently we have 15 plugins, in 15 repositories:</p>

    <aside class="notes">
      Currently we have 15 plugins, in 15 different repositories
    </aside>

    <div class="clearfix"></div>
    <ul class="text-sm col-4 list-none">
      <li><div class="plugin"><span class="title">attendee_tournaments</span></div></li>
      <li><div class="plugin"><span class="title">bands</span></div></li>
      <li>
        <div class="plugin"><span class="title">barcode</span></div>
        <span class="fragment text-bold">
          github.com/rams?!
          <aside class="notes">
            Including the barcode plugin, which – side note – for some
            inexplicable reason is under the <em>rams</em> account instead of
            the MAGFest account. And it's not even the RAMSProject account.
            Barcode has its own account that's just called <em>rams</em>, but
            its like the only project in that account.
            <br><br>
            Which is fine, except I always forget the barcode plugin exists,
            because I'm always looking in the MAGFest account. But whatever!
          </aside>
        </span>
      </li>
      <li><div class="plugin"><span class="title">hotel</span></div></li>
      <li><div class="plugin"><span class="title">magclassic</span></div></li>
    </ul>
    <ul class="text-sm col-4 list-none">
      <li><div class="plugin"><span class="title">magfest</span></div></li>
      <li><div class="plugin"><span class="title">magprime</span></div></li>
      <li><div class="plugin"><span class="title">magstock</span></div></li>
      <li><div class="plugin"><span class="title">magwest</span></div></li>
      <li><div class="plugin"><span class="title">mivs</span></div></li>
    </ul>
    <ul class="text-sm col-4 list-none">
      <li><div class="plugin"><span class="title">panels</span></div></li>
      <li><div class="plugin"><span class="title">reports</span></div></li>
      <li><div class="plugin"><span class="title">tabletop</span></div></li>
      <li><div class="plugin"><span class="title">uber</span></div></li>
      <li><div class="plugin"><span class="title">uber_analytics</span></div></li>
    </ul>
    <div class="clearfix"></div>
    <div class="fragment">
      <p>Additionally we have our own application server:</p>
      <ul class="text-sm col-4 list-none">
        <li><div class="service inline-block"><span class="title">sideboard</span></div></li>
      </ul>
      <aside class="notes">
        Additionally we have our own application server called sideboard that
        also lives in its own repo.
      </aside>
    </div>
  </section>

  <section>
    <h1>Refactor</h1>
    <p>We have 4 deployment configurations:</p>

    <aside class="notes">
      We have 4 different deployment configurations, one for each event we
      host.
    </aside>

    <div class="clearfix"></div>
    <div class="col-3">
      <h4>MAGFest</h4>
      <ul class="text-xs list-none">
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">attendee_tournaments</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">bands</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">barcode</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">hotel</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">magfest</span></div>
          </div>
        </li>
        <li>
          <div class="fragment grow" data-fragment-index="2">
            <aside class="notes">
              The only real differences come from the event specific plugins –
              of which there are four, one for each event. The main differences
              these event specific plugins introduce are theme and template
              changes. Different images, different css, different wording and
              layout tweaks in the templates.
            </aside>
            <div class="plugin"><span class="title">magprime</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">mivs</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">panels</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">reports</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">tabletop</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">uber</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">uber_analytics</span></div>
          </div>
        </li>
      </ul>
    </div>
    <div class="col-3">
      <h4>MAGLabs</h4>
      <ul class="text-xs list-none">
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">attendee_tournaments</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">bands</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">barcode</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">hotel</span></div>
          </div>
        </li>
        <li>
          <div class="fragment grow" data-fragment-index="2">
            <div class="plugin"><span class="title">magclassic</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">magfest</span></div>
          </div>
        </li>
        <li>
          <div class="fragment" data-fragment-index="1">
            <aside class="notes">
              If you look closely, you'll notice that each deployment
              configuration is <i>almost</i> a strict subset of the main
              MAGFest configuration. Which makes sense when you consider that
              an event like MAGStock isn't going to have a hotel, so it doesn't
              really need the hotel plugin.
              <br><br>
              So what are the actual differences between each deployment?
            </aside>
            <div class="fragment fade-out" data-fragment-index="2">
              <div class="plugin text-light"><span class="title">mivs</span></div>
            </div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">panels</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">reports</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">tabletop</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">uber</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">uber_analytics</span></div>
          </div>
        </li>
      </ul>
    </div>
    <div class="col-3">
      <h4>MAGStock</h4>
      <ul class="text-xs list-none">
        <li>
          <div class="fragment" data-fragment-index="1">
            <div class="fragment fade-out" data-fragment-index="2">
              <div class="plugin text-light"><span class="title">attendee_tournaments</span></div>
            </div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">bands</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">barcode</span></div>
          </div>
        </li>
        <li>
          <div class="fragment" data-fragment-index="1">
            <div class="fragment fade-out" data-fragment-index="2">
              <div class="plugin text-light"><span class="title">hotel</span></div>
            </div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">magfest</span></div>
          </div>
        </li>
        <li>
          <div class="fragment grow" data-fragment-index="2">
            <div class="plugin"><span class="title">magstock</span></div>
          </div>
        </li>
        <li>
          <div class="fragment" data-fragment-index="1">
            <div class="fragment fade-out" data-fragment-index="2">
              <div class="plugin text-light"><span class="title">mivs</span></div>
            </div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">panels</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">reports</span></div>
          </div>
        </li>
        <li>
          <div class="fragment" data-fragment-index="1">
            <div class="fragment fade-out" data-fragment-index="2">
              <div class="plugin text-light"><span class="title">tabletop</span></div>
            </div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">uber</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">uber_analytics</span></div>
          </div>
        </li>
      </ul>
    </div>
    <div class="col-3">
      <h4>MAGWest</h4>
      <ul class="text-xs list-none">
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">attendee_tournaments</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">bands</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">barcode</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">hotel</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">magfest</span></div>
          </div>
        </li>
        <li>
          <div class="fragment grow" data-fragment-index="2">
            <div class="plugin"><span class="title">magwest</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">mivs</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">panels</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">reports</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">tabletop</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">uber</span></div>
          </div>
        </li>
        <li>
          <div class="fragment fade-out" data-fragment-index="2">
            <div class="plugin"><span class="title">uber_analytics</span></div>
          </div>
        </li>
      </ul>
    </div>
    <div class="clearfix"></div>
    <p class="fragment text-lg" data-fragment-index="2">
      Only real differences come from the event plugins
    </p>
  </section>

  <section>
    <h1>Refactor</h1>
    <p>
      Of the event plugins, only
      <span class="plugin"><span class="title">magprime</span></span> and
      <span class="plugin"><span class="title">magstock</span></span>
      modify the database
    </p>

    <aside class="notes">
      Of the event plugins, only <code>magprime</code> and
      <code>magstock</code> actually modify the database. And if we examine
      the database changes made by each, we'll see that they'd either be
      already usable by all our events, or could easily be genericized to work
      for any of our events.
    </aside>

    <div class="col-6 fragment fade-in">
      <h4>MAGFest</h4>

      <aside class="notes">
        The <code>magprime</code> plugin adds support for tracking previous
        season supporters and season ticket holders – a feature that would work
        well for any event.
      </aside>

      <div class="panel db text-xs">
        <h1 class="title">prev_season_supporter</h1>
        <ul>
          <li>id</li>
          <li>first_name</li>
          <li>last_name</li>
          <li>email</li>
        </ul>
      </div>
      <div class="panel db text-xs">
        <h1 class="title">season_pass_ticket</h1>
        <ul>
          <li>id</li>
          <li>fk_id</li>
          <li>slug</li>
        </ul>
      </div>
      <div class="panel db text-xs">
        <h1 class="title">attendee</h1>
        <ul>
          <li>extra_donation</li>
        </ul>
      </div>
    </div>

    <div class="col-6 fragment fade-in">
      <h4>MAGStock</h4>

      <aside class="notes">
        Whereas the <code>magstock</code> plugin adds support for campground
        preferences. But if you stop and think about it, that could easily be
        implemented using a more generic "accommodation" model, where a
        campground is just one specific type of accommodation.
        <br><br>
        So, when you actually look at our different deployment configurations,
        they're not so wildly different that they couldn't be handled by a
        single more generic deployment configuration.
      </aside>

      <div class="panel db text-xs">
        <h1 class="title">attendee</h1>
        <ul>
          <li>site_type</li>
          <li>site_number</li>
          <li>purchased_food</li>
          <li>noise_level</li>
          <li>license_plate</li>
          <li>coming_with</li>
          <li>coming_as</li>
          <li>camping_type</li>
          <li>allergies</li>
        </ul>
      </div>
    </div>
  </section>

  <section>
    <h1>Refactor</h1>

    <aside class="notes">
      The structure of our deployments looks like this. At the top level we
      have a clone of the sideboard git repository.
    </aside>
    <span class="fragment" data-fragment-index="1">
      <aside class="notes">
        Sideboard itself has a configuration file, which – for historic
        reasons – is called development.ini. This houses a lot of the
        service config I mentioned earlier. It's a small file, and has
        the kind of config data you'd expect – ip addresses, and ports, etc...
        But it also specifies the location of the "plugins" directory.
      </aside>
    </span>
    <span class="fragment" data-fragment-index="2">
      <aside class="notes">
        Which may or may not be physically located inside the sideboard
        directory.
      </aside>
    </span>
    <span class="fragment" data-fragment-index="3">
      <aside class="notes">
        In either case, each plugin is deployed by cloning the
        plugin's git repository underneath the "plugins" directory.
      </aside>
    </span>
    <span class="fragment" data-fragment-index="4">
      <aside class="notes">
        Finally, the uber plugin has its own development.ini
        config file. This houses a bit of additional service
        configuration, and <em>all</em> of our event
        configuration. These are the settings that define an
        event: the start date, the end date, the badge prices,
        and on, and on, and on...
        <br><br>
        It's a pretty big file.
        <br><br>
        In reality each plugin has its own config file, but most
        of them are either completely empty, or rarely updated,
        if they're used at all.
      </aside>
    </span>
    <span class="fragment" data-fragment-index="5">
      <aside class="notes">
        Despite the fact that we have this big, complicated deployment
        structure, like 95% of the work happens right here, in the uber plugin.
      </aside>
    </span>

    <p class="fragment fade-out" data-fragment-index="5">The structure of our deployments looks like this:</p>
    <div class="col-7">
      <div class="panel service block text-left text-sm">
        <h1 class="title inline-block fragment fade-out" data-fragment-index="5">sideboard</h1>
        <span class=" fragment fade-out" data-fragment-index="5">
          <div class="panel file inline-block pull-right fragment fade-in" data-fragment-index="1">
            <span class="title">development.ini</span>
          </div>
        </span>
        <div class="panel folder block fragment fade-in" data-fragment-index="2">
          <h1 class="title fragment fade-out" data-fragment-index="5">plugins</h1>
          <div class="fragment fade-in" data-fragment-index="3">
            <ul class="col-6 fragment fade-out" data-fragment-index="5">
              <li>
                <div class="plugin">
                  <span class="title">attendee_tournaments</span>
                </div>
              </li>
              <li>
                <div class="plugin">
                  <span class="title">bands</span>
                </div>
              </li>
              <li>
                <div class="plugin">
                  <span class="title">barcode</span>
                </div>
              </li>
              <li>
                <div class="plugin">
                  <span class="title">hotel</span>
                </div>
              </li>
              <li>
                <div class="plugin">
                  <span class="title">magfest</span>
                </div>
              </li>
              <li>
                <div class="plugin">
                  <span class="title">magprime</span>
                </div>
              </li>
            </ul>
            <ul class="col-6">
              <li>
                <div class="plugin fragment fade-out" data-fragment-index="5">
                  <span class="title">mivs</span>
                </div>
              </li>
              <li>
                <div class="plugin fragment fade-out" data-fragment-index="5">
                  <span class="title">panels</span>
                </div>
              </li>
              <li>
                <div class="plugin fragment fade-out" data-fragment-index="5">
                  <span class="title">reports</span>
                </div>
              </li>
              <li>
                <div class="plugin fragment fade-out" data-fragment-index="5">
                  <span class="title">tabletop</span>
                </div>
              </li>
              <li>
                <div class="plugin fragment grow" data-fragment-index="5">
                  <span class="title">uber</span>
                  <div class="panel file inline-block pull-right fragment fade-in" data-fragment-index="4">
                    <span class="title">development.ini</span>
                  </div>
                  <div class="clearfix"></div>
                </div>
              </li>
              <li>
                <div class="plugin fragment fade-out" data-fragment-index="5">
                  <span class="title">uber_analytics</span>
                </div>
              </li>
            </ul>
          </div>
          <div class="clearfix"></div>
        </div>
      </div>
    </div>
    <div class="col-5">
      <p class="fragment fade-in" data-fragment-index="5" style="margin-top: 58%">
        95% of the work happens here
      </p>
    </div>
  </section>

  <section>
    <h1>Refactor</h1>

    <aside class="notes">
      As a programmer, my first instinct is always to throw out the old code
      and rewrite it from scratch – but this time we'll <em>do it right</em>!
      <br><br>
      In reality, a complete rewrite is almost always a bad idea. So instead
      of rewriting the whole thing, why don't we do something like this...
    </aside>
    <span class="fragment" data-fragment-index="1">
      <aside class="notes">
        First, we make Ubersystem the single, top level repository.
      </aside>
    </span>
    <span class="fragment" data-fragment-index="2">
      <aside class="notes">
        Next instead of separate plugins – each with separate repositories – we
        suck all the plugins into the main repository. And instead of using the
        plugin architecture, we can convert all the existing plugins to regular
        old python modules.
      </aside>
    </span>
    <span class="fragment" data-fragment-index="3">
      <aside class="notes">
        And instead of deploying sideboard as a host service, we can import it
        like we would any other third party library. It can be listed in our
        "requirements.txt" alongside the rest of our dependencies.
      </aside>
    </span>
    <span class="fragment" data-fragment-index="4">
      <aside class="notes">
        We'll have just a single small config file, consisting mainly of our
        service configuration. And that...
      </aside>
    </span>

    <p>A complete rewrite is almost always a bad idea, but what about...</p>
    <div class="col-7">
      <div class="panel service block text-left text-sm">
        <h1 class="title fragment fade-in" data-fragment-index="1">Ubersystem</h1>
        <div class="panel package block fragment fade-in" data-fragment-index="2">
          <h1 class="title">python modules</h1>
          <ul class="col-6">
            <li>uber</li>
            <li>uber.analytics</li>
            <li>uber.attendee_tournaments</li>
            <li>uber.bands</li>
            <li>uber.barcode</li>
            <li>uber.core</li>
          </ul>
          <ul class="col-6">
            <li>uber.hotel</li>
            <li>uber.magfest</li>
            <li>uber.mivs</li>
            <li>uber.panels</li>
            <li>uber.reports</li>
            <li>uber.tabletop</li>
          </ul>
          <div class="clearfix"></div>
        </div>
        <div class="panel file block fragment fade-in" data-fragment-index="3">
          <h1 class="title">requirements.txt</h1>
          <div class="col-12">sideboard>=1.0</div>
          <div class="clearfix"></div>
        </div>
        <div class="panel file block fragment fade-in" data-fragment-index="4">
          <h1 class="title">ubersystem.cfg</h1>
        </div>
      </div>
    </div>
    <div class="col-5 text-sm">
      <p class="fragment fade-in" data-fragment-index="1">
        Single repository
      </p>
      <p class="fragment fade-in" data-fragment-index="2">
        Plugins converted to regular python modules
      </p>
      <p class="fragment fade-in" data-fragment-index="3" style="margin-top: 36%;">
        Sideboard imported like a normal library
      </p>
      <p class="fragment fade-in" data-fragment-index="4" style="margin-top: 11%;">
        Single config file
      </p>
    </div>
  </section>

  <section>
    <h1 style="margin-bottom: 0;">Refactor</h1>

    <aside class="notes">
      Will look like this...
      <br><br>
      There shouldn't be anything surprising in here.
    </aside>

    <h3>Service config</h3>
    <div class="panel file text-xs">
      <h1 class="title">ubersystem.cfg</h1>
<pre><code data-trim data-noescape>
aws_access_key = "abcxyz"
aws_secret_key = "abcxyz"
qr_code_password = "abcxyz"
stripe_secret_key = "sk_test_abcxyz"
stripe_public_key = "pk_test_abcxyz"

[cherrypy]
server.socket_host = "127.0.0.1"
server.socket_port = 8282

[sqlalchemy]
url = "postgresql://user:pass@localhost:5432/db"
</code></pre>
    </div>
    <ul>
      <li class="fragment">
        Makes packaging super easy
        <aside class="notes">
          A single simple config file make packaging super easy.
        </aside>
      </li>
      <li class="fragment">
        Makes configuration management super easy
        <aside class="notes">
          It makes configuration management super easy.
        </aside>
      </li>
      <li class="fragment">
        Makes containerization super easy
        <aside class="notes">
          It makes containerization super easy.
        </aside>
      </li>
      <li class="fragment">
        Universally understood paradigm
        <aside class="notes">
          It's a universally understood paradigm. There's nothing in this
          config file that's gonna be suprising to any system administrator.
        </aside>
      </li>
      <li class="fragment">
        Think of your config as an API
        <aside class="notes">
          Just as side note, I'd like you to start thinking of your config as
          an API. It's the interface through which sysadmins interact with
          your software.
        </aside>
        <span class="fragment">
          – don't burden yourself with an overly complex API
          <aside class="notes">
            So, you know, be kind to your sysadmins. Be kind to yourself.
            Don't burder yourself with an overly complex API.
            <br><br>
            Keep it simple!
          </aside>
        </span>
      </li>
    </ul>
  </section>

  <section>
    <h1 style="margin-bottom: 0;">Refactor</h1>

    <aside class="notes">
      If that's the extent of our config file, what happens to all of our
      event configuration? The rest of our old "development.ini" file?
      <br><br>
      Well, it's all going to end up in the database, and the way we do that
      will vary based on the types of values we're dealing with.
    </aside>
    <span class="fragment" data-fragment-index="1">
      <aside class="notes">
        A lot of the settings are just straight key/value pairs, like these.
      </aside>
    </span>
    <span class="fragment" data-fragment-index="2">
      <aside class="notes">
        And key/value pairs are the easiest to deal with, as they directly map
        to columns in a new "event" table.
      </aside>
    </span>
    <span class="fragment" data-fragment-index="3">
      <aside class="notes">
        But if we want, we can get fancy with some of our key/value settings.
        For example, it might be a good idea to split the venue off into its
        own table. In which case we'd add a foreign key column to create a
        one-to-many relationship.
      </aside>
    </span>
    <span class="fragment" data-fragment-index="4">
      <aside class="notes">
        We also have a lot of subsections in our config, like the
        "badge_ranges" section. We have several options for how we store
        settings like this. And the choice we make will largely be based on
        how the data is used.
      </aside>
    </span>
    <span class="fragment" data-fragment-index="5">
      <aside class="notes">
        For data that we don't query very often, like "badge_ranges", we can
        take advantage of Postgres' structured data columns, like "jsonb".
        We can just shove the whole "badge_ranges" dictionary in a JSON
        column and call it a day.
      </aside>
    </span>
    <span class="fragment" data-fragment-index="6">
      <aside class="notes">
        Or, for some of our more complicated subsections, we may consider
        breaking them up into separate tables. For example, our
        "job_location" enum section...
      </aside>
    </span>
    <span class="fragment" data-fragment-index="7">
      <aside class="notes">
        ...may be best represented as a standalone "department" table.
      </aside>
    </span>

    <h3>Event config</h3>
    <div class="col-6">
      <div class="panel file text-xs">
        <h1 class="title">development.ini</h1>
<pre><code data-trim data-noescape><span class="fragment fade-in" data-fragment-index="1">at_the_con = False
event_timezone = "US/Pacific"
event_venue = "The Hyatt Regency"
event_venue_address = "5101 Great America Pkwy"
max_badge_sales = 20000
student_discount = 10</span>
<span class="fragment fade-in" data-fragment-index="4">
[badge_ranges]
staff_badge = 49, 199
guest_badge = 200, 299
attendee_badge = 300, 2299
one_day_badge = 2300, 3199</span>
<span class="fragment fade-in" data-fragment-index="6">
[enums]
[[job_location]]
arcade = "Arcade"
challenges = "Challenges"
charity = "Charity"
chipspace = "Chipspace"
dorsai = "Dorsai"</span>
</code></pre>
      </div>
    </div>
    <div class="col-6">
      <div class="col-6" style="padding-left: 0">
        <div class="panel db text-xs fragment fade-in" data-fragment-index="2">
          <h1 class="title">event</h1>
          <ul>
            <li>id: <i>uuid</i></li>
            <li>at_the_con: <i>boolean</i></li>
            <li>timezone: <i>text</i></li>
            <li>max_badge_sales: <i>int</i></li>
            <li>student_discount: <i>int</i></li>
            <li class="fragment fade-in" data-fragment-index="3">venue_id: <i>foreign_key</i></li>
            <li class="fragment fade-in" data-fragment-index="5">badge_ranges: <i>jsonb</i></li>
          </ul>
        </div>
      </div>
      <div class="col-6" style="padding-right: 0">
        <div class="panel db text-xs fragment fade-in" data-fragment-index="3">
          <h1 class="title">venue</h1>
          <ul>
            <li>id: <i>uuid</i></li>
            <li>address: <i>text</i></li>
            <li>name: <i>text</i></li>
          </ul>
        </div>
      </div>
      <div class="clearfix" style="margin-bottom: 15px;"></div>
      <div class="col-6" style="padding-left: 0">
        <div class="panel db text-xs fragment fade-in" data-fragment-index="7">
          <h1 class="title">department</h1>
          <ul>
            <li>id: <i>uuid</i></li>
            <li>name: <i>text</i></li>
            <li>description: <i>text</i></li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <section>
    <h1 style="margin-bottom: 0;">Refactor</h1>

    <aside class="notes">
      Let's take a closer look at what the actual "event" table will look like.
      It'll have an "id" column for its primary key. Probably a "name" column,
      a "start_date", an "end_date", and so on...
    </aside>
    <span class="fragment" data-fragment-index="1">
      <aside class="notes">
        And the data in the table will probably look something like this. The
        values from our old config file will basically be transplanted directly
        into the "event" table.
        <br><br>
        Not too exciting so far. But wait a second... This is a database table,
        right? So it can store more than one row!
      </aside>
    </span>
    <span class="fragment" data-fragment-index="2">
      <aside class="notes">
        We can store all the settings for a second event in the same table!
        <br><br>
        Here we have both Super 2017 and 2018 in the same database!
      </aside>
    </span>
    <span class="fragment" data-fragment-index="3">
      <aside class="notes">
        And if we're storing multiple events, we can even store totally
        different <em>types</em> of events. Like having <em>both</em> Super
        MAGFest and MAGWest in the same database!
        <br><br>
        <i>Head explodes!</i>
      </aside>
    </span>
    <span class="fragment" data-fragment-index="4">
      <aside class="notes">
        Yeah, ok, so we have multiple events in the same database table. How
        does that affect the rest of the system?
        <br><br>
        Well, lets start by examining the "attendee" table.
      </aside>
    </span>
    <span class="fragment" data-fragment-index="5">
      <aside class="notes">
        We've got an attendee...
      </aside>
    </span>
    <span class="fragment" data-fragment-index="6">
      <aside class="notes">
        Attendee...
      </aside>
    </span>
    <span class="fragment" data-fragment-index="7">
      <aside class="notes">
        Attendee...
        <br><br>
        How do we know which event these attendees attended?!
      </aside>
    </span>
    <span class="fragment" data-fragment-index="8">
      <aside class="notes">
        We add an "event_id" column! Here we see the first two attendees are
        going to MAGFest 2018, and the third attendee is going to MAGWest.
        <br><br>
        <i>Head explodes!</i>
        <br><br>
        Ok, so it's not <em>that</em> amazing. This is basically "Database
        Design 101". But I think it demonstrates that by simply cleaning up
        our codebase, and removing some of our current pain points, the
        natural consequence is a multi-event, multi-year system.
        <br><br>
        I've tried to structure this presentation like a lawyer building a
        case. Starting with small, seemingly inconsequential changes – that we
        can all agree on – I've built layer on top of layer. Until finally,
        when we step back and look at the system as a whole, the conclusion
        is self evident.
        <br><br>
        There's been a lot of hand wringing and overwrought discussion about
        how to design a "multi-year" Ubersystem. But the truth is that a
        multi-year system is the logical conclusion of simply correcting some
        of our early design decisions.
        <br><br>
        That's all there is to it!
      </aside>
    </span>

    <div class="panel db text-xs">
      <h1 class="title">event</h1>
      <div class="db-table">
        <table>
          <thead>
            <tr>
              <th>id</th>
              <th>name</th>
              <th>start_date</th>
              <th>end_date</th>
              <th>timezone</th>
              <th>&nbsp;...&nbsp;</th>
              <th>&nbsp;...&nbsp;</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><span class="fragment fade-in" data-fragment-index="1">b652524c...</span></td>
              <td><span class="fragment fade-in" data-fragment-index="1">Super MAGFest 2017</span></td>
              <td><span class="fragment fade-in" data-fragment-index="1">2017-01-05 12:00</span></td>
              <td><span class="fragment fade-in" data-fragment-index="1">2017-01-09 12:00</span></td>
              <td><span class="fragment fade-in" data-fragment-index="1">EST</span></td>
              <td><span class="fragment fade-in" data-fragment-index="1">&nbsp;...&nbsp;</span></td>
              <td><span class="fragment fade-in" data-fragment-index="1">&nbsp;...&nbsp;</span></td>
            </tr>
            <tr>
              <td><span class="fragment fade-in" data-fragment-index="2">7ff9ec4e...</span></td>
              <td><span class="fragment fade-in" data-fragment-index="2">Super MAGFest 2018</span></td>
              <td><span class="fragment fade-in" data-fragment-index="2">2018-01-04 12:00</span></td>
              <td><span class="fragment fade-in" data-fragment-index="2">2018-01-08 12:00</span></td>
              <td><span class="fragment fade-in" data-fragment-index="2">EST</span></td>
              <td><span class="fragment fade-in" data-fragment-index="2">&nbsp;...&nbsp;</span></td>
              <td><span class="fragment fade-in" data-fragment-index="2">&nbsp;...&nbsp;</span></td>
            </tr>
            <tr>
              <td><span class="fragment fade-in" data-fragment-index="3">527b039a...</span></td>
              <td><span class="fragment fade-in" data-fragment-index="3">MAGWest 2017</span></td>
              <td><span class="fragment fade-in" data-fragment-index="3">2017-08-25 12:00</span></td>
              <td><span class="fragment fade-in" data-fragment-index="3">2017-08-27 12:00</span></td>
              <td><span class="fragment fade-in" data-fragment-index="3">PDT</span></td>
              <td><span class="fragment fade-in" data-fragment-index="3">&nbsp;...&nbsp;</span></td>
              <td><span class="fragment fade-in" data-fragment-index="3">&nbsp;...&nbsp;</span></td>
            </tr>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
            </tr>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
            </tr>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="panel db text-xs fragment fade-in" data-fragment-index="4" style="margin-top: 1.5em;">
      <h1 class="title">attendee</h1>
      <div class="db-table">
        <table>
          <thead>
            <tr>
              <th>id</th>
              <th>badge_num</th>
              <th>registered</th>
              <th>staffing</th>
              <th>&nbsp;...&nbsp;</th>
              <th>&nbsp;...&nbsp;</th>
              <th>&nbsp;...&nbsp;</th>
              <th class="fragment fade-in" data-fragment-index="8">event_id</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><span class="fragment fade-in" data-fragment-index="5">9a71a504...</span></td>
              <td><span class="fragment fade-in" data-fragment-index="5">53</span></td>
              <td><span class="fragment fade-in" data-fragment-index="5">2017-08-08 19:52</span></td>
              <td><span class="fragment fade-in" data-fragment-index="5">True</span></td>
              <td><span class="fragment fade-in" data-fragment-index="5">&nbsp;...&nbsp;</span></td>
              <td><span class="fragment fade-in" data-fragment-index="5">&nbsp;...&nbsp;</span></td>
              <td><span class="fragment fade-in" data-fragment-index="5">&nbsp;...&nbsp;</span></td>
              <td class="fragment fade-in" data-fragment-index="8">7ff9ec4e...</td>
            </tr>
            <tr>
              <td><span class="fragment fade-in" data-fragment-index="6">569e914b...</span></td>
              <td><span class="fragment fade-in" data-fragment-index="6">54</span></td>
              <td><span class="fragment fade-in" data-fragment-index="6">2017-08-09 12:01</span></td>
              <td><span class="fragment fade-in" data-fragment-index="6">True</span></td>
              <td><span class="fragment fade-in" data-fragment-index="6">&nbsp;...&nbsp;</span></td>
              <td><span class="fragment fade-in" data-fragment-index="6">&nbsp;...&nbsp;</span></td>
              <td><span class="fragment fade-in" data-fragment-index="6">&nbsp;...&nbsp;</span></td>
              <td class="fragment fade-in" data-fragment-index="8">7ff9ec4e...</td>
            </tr>
            <tr>
              <td><span class="fragment fade-in" data-fragment-index="7">b729f113...</span></td>
              <td><span class="fragment fade-in" data-fragment-index="7">52</span></td>
              <td><span class="fragment fade-in" data-fragment-index="7">2017-08-10 07:08</span></td>
              <td><span class="fragment fade-in" data-fragment-index="7">False</span></td>
              <td><span class="fragment fade-in" data-fragment-index="7">&nbsp;...&nbsp;</span></td>
              <td><span class="fragment fade-in" data-fragment-index="7">&nbsp;...&nbsp;</span></td>
              <td><span class="fragment fade-in" data-fragment-index="7">&nbsp;...&nbsp;</span></td>
              <td class="fragment fade-in" data-fragment-index="8">527b039a...</td>
            </tr>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
              <td class="fragment fade-in" data-fragment-index="8"></td>
            </tr>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
              <td>&nbsp;</td>
              <td class="fragment fade-in" data-fragment-index="8"></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <section>
    <h1 style="margin-bottom: 0;">Refactor</h1>

    <aside class="notes">
      But that's not the end of the story! There's still lots of opportunity
      for improvements!
    </aside>

    <h2>That's not the end of the story!</h2>
    <ol>
      <li class="fragment">
        Split <code>attendee</code> table into <code>person</code> table and
        <code>registration</code> table
        <aside class="notes">
          We can split the <code>attendee</code> table into a
          <code>person</code> table and <code>registration</code> table
        </aside>
      </li>
      <li class="fragment">
        Create actual user accounts!
        <aside class="notes">
          We can create actual user accounts!
        </aside>
      </li>
      <li class="fragment">
        Fine grained permissions model
        <aside class="notes">
          We can add a fine grained permissions model
        </aside>
      </li>
      <li class="fragment">
        Customizable templates by storing user editable blocks in the database
        <aside class="notes">
          Here's a big one. We can create user-customizable templates by
          storing template blocks in the database. Think about it, an admin
          could customize an event's preregistration page without any
          intervention by a software developer.
          <br><br>
          <i>Head explodes!</i>
        </aside>
      </li>
      <li class="fragment">
        Support online creation and editing of automated emails
        <aside class="notes">
          We can even take that a step further by supporting the
          <em>online</em> creation and editing of automated emails.
          <br><br>
          Need to edit the working of an email? No problem! You can do that
          right from the browser!
        </aside>
      </li>
      <li class="fragment">
        And many more features as we go!
        <aside class="notes">
          And that's not the end either! We can keep adding features as we go!
          <br><br>
          So what's next?
        </aside>
      </li>
    </ol>
  </section>
</section>

<section>
  <section>
    <h1>Reggie</h1>
    <aside class="notes">
      I'd like to introduce you to reggie.
    </aside>
    <h2 class="fragment">
      The registration system!
      <aside class="notes">
        The registration system!
        <br><br>
        Although... reggie actually needs no introduction. Though you may not
        have realized it, I've been talking about reggie for the past 20
        minutes! Reggie is the name we're giving to our new registration
        system, born from the ashes of Uber and RAMS.
        <br><br>
        As we've seen, it's going to share a lot of the same guts with as our
        old system, so navigating the source code will seem familiar to anyone
        that's worked on Uber already.
      </aside>
    </h2>
  </section>

  <section>
    <h1>Reggie</h1>
    <aside class="notes">
      Now I'd like to spend a little time reviewing the overall system design.
    </aside>
    <div class="img">
      <span class="fragment fade-in">
        <img class="img-layer" src="images/architecture01.png">
        <aside class="notes">
          The most prominent component of reggie is the web application. Much
          like Ubersystem, reggie will be built on cherrypy and SQLAlchemy.
        </aside>
      </span>
      <span class="fragment fade-in">
        <img class="img-layer" src="images/architecture02.png">
        <aside class="notes">
          The core of reggie is the data model, built using SQLAlchemy.
          Validations and permissions will be built directly on top of the
          data model, so every part of the application will be subject to
          those constraints.
        </aside>
      </span>
      <span class="fragment fade-in">
        <img class="img-layer" src="images/architecture03.png">
        <aside class="notes">
          The user interface will be built using Jinja templates to render
          HTML, bootstrap for styling, and a sprinkling of AJAX to make the
          interface more interactive. We're not gonna get too fancy with our
          web technology stack. These are tools that almost every developer
          out there will be familiar with. The less magic we use, the easier
          it will be to onboard new developers.
        </aside>
      </span>
      <span class="fragment fade-in">
        <img class="img-layer" src="images/architecture04.png">
        <aside class="notes">
          Unlike Ubersystem, reggie's JSON API will be a first class citizen.
          Capable of accepting all the authentication mechanisms available to
          the web interface, and subject to all the same permissions and
          validations.
          <br><br>
          This will be the same API used by reggie interally, so there will
          be plenty of examples for third party projects to follow.
        </aside>
      </span>
      <span class="fragment fade-in">
        <img class="img-layer" src="images/architecture05.png">
        <aside class="notes">
          While cherrypy is inherently multithreaded, reggie won't spin up any
          additional tasks in background threads. From day one, we'll be able
          to spin up as many reggie servers as we'd like.
        </aside>
      </span>
      <span class="fragment fade-in">
        <img class="img-layer" src="images/architecture06.png">
        <aside class="notes">
          Obviously, our reggie servers will live behind a load balancer.
          We'll probably just stick with NGINX to start with.
        </aside>
      </span>
      <span class="fragment fade-in">
        <img class="img-layer" src="images/architecture07.png">
        <aside class="notes">
          Of course, from an outside perspective, this will only look like a
          single server. And we can have a ton of these boxes. As many as we
          need to handle the load.
          <br><br>
          For example, our current production server has four CPUs, so our
          production config would probably spin up four reggie servers on that
          box. And we could have multiples of those boxes. Like, for prereg
          launch, we could stand up ten servers for a week, and then scale
          back down to a single server when the traffic subsides.
        </aside>
      </span>
      <span class="fragment fade-in">
        <img class="img-layer" src="images/architecture08.png">
        <aside class="notes">
          Running multiple servers means they need access to some shared
          resource to track sessions. I'm thinking Redis would be perfect for
          that task. I've had great success with Redis in the past.
          <ul>
            <li>It's fast</li>
            <li>It's reliable</li>
            <li>It's easy to configure</li>
            <li>It's easy to scale if we really start growing</li>
          </ul>
          Plus there's really no reason to burden Postgres by shoving it full
          of session data.
        </aside>
      </span>
      <span class="fragment fade-in">
        <img class="img-layer" src="images/architecture09.png">
        <aside class="notes">
          Speaking of which! We're sticking with Postgres, cause it's awesome!
          And it keeps getting better!
        </aside>
      </span>
      <span class="fragment fade-in">
        <img class="img-layer" src="images/architecture10.png">
        <aside class="notes">
          Finally, we have our email server. It lives in a separate process.
          We can spin it up anywhere, same box, different box, whatever. It's
          got a really simple task and it'll just hang out in the background
          doing it's job.
          <br><br>
          The picture I've presented here is really just phase one. This is
          essentially the most basic system design possible. Consider it the
          first milestone we're working towards on a very long journey.
        </aside>
      </span>
    </div>
  </section>

  <section>
    <h1>Reggie</h1>
    <h2>Future Improvements</h2>
    <ol>
      <li class="fragment">Database replication with failover</li>
      <li class="fragment">Database caching layer</li>
      <li class="fragment">Database sharding, perhaps per-event</li>
      <li class="fragment">LDAP authentication</li>
      <li class="fragment">Pub/sub message queue</li>
      <li class="fragment">Web socket support</li>
      <li class="fragment text-xl">To infinity and beyond!</li>
    </ol>
  </section>
</section>

<section class="text-center">
  <h1><span class="text-md fragment">Questions?</span></h1>
  <h1><span class="text-lg fragment">Comments?</span></h1>
  <h1><span class="text-xl fragment">Growing concerns?</span></h1>
</section>

      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>
      function hasClass(element, selector) {
          var className = " " + selector + " ";
          return (element.nodeType === 1 &&
              (" " + element.className + " ").replace(/[\t\r\n]/g, " ").indexOf(className) >= 0);
      }

      // More info https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: false,

        width: 1600,
        height: 900,

        transition: 'slide', // none/fade/slide/convex/concave/zoom
        transitionSpeed: 'fast', // default/fast/slow
        backgroundTransition: 'fade', // none/fade/slide/convex/concave/zoom

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() {
            return !document.body.classList;
          } },
          { src: 'plugin/markdown/marked.js', condition: function() {
            return !!document.querySelector( '[data-markdown]' );
          } },
          { src: 'plugin/markdown/markdown.js', condition: function() {
            return !!document.querySelector( '[data-markdown]' );
          } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() {
            hljs.initHighlightingOnLoad();
          } },
          { src: 'plugin/zoom-js/zoom.js', async: true },
          { src: 'plugin/notes/notes.js', async: true }
        ]
      });

      Reveal.addEventListener('fragmentshown', function(event) {
        if (hasClass(event.fragment, 'fragment-bg-red')) {
          console.log('fragment-bg-red')
        }
      });

    </script>
  </body>
</html>
